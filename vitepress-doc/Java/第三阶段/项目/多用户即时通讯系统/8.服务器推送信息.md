---
aside: right
outline: [2, 3]
---

<h1 style="text-align: center; font-weight: bold;">æœåŠ¡å™¨æ¨é€ä¿¡æ¯</h1>

---

##### è®¾è®¡æ€è·¯ï¼ˆ<span style = "color:red;font-weight:bold">éå¸¸é‡è¦ï¼ï¼ï¼</span>ï¼‰

![alt text](è®¾è®¡æ€è·¯.png)

### ï¼ˆ1ï¼‰æ€è·¯ä»‹ç»

æœåŠ¡å™¨æ¨é€ä¿¡æ¯çš„æœ¬è´¨æ˜¯ç¾¤å‘ï¼Œéå†æ‰€æœ‰çº¿ç¨‹é›†åˆï¼Œæ‹¿åˆ° socket åå‘é€ä¿¡æ¯å³å¯ï¼Œ<span style = "color:red;font-weight:bold">åŒæ—¶æ¨é€ä¿¡æ¯ä¹Ÿéœ€è¦æ˜¯ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™é‡Œå•ç‹¬å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹ç”¨æ¥æ¨é€æ¶ˆæ¯</span>

### ï¼ˆ2ï¼‰æœåŠ¡ç«¯

åœ¨ service åŒ…ä¸‹ç¼–å†™ä¸€ä¸ªç±» **SendNewsToAllService** ç»§æ‰¿ **Runable** æ¥å£

```java
package service;

import common.Message;
import common.MessageType;
import utils.Utility;

import java.io.IOException;
import java.io.ObjectOutputStream;
import java.util.Date;
import java.util.HashMap;
import java.util.Iterator;

public class SendNewsToAllService implements Runnable {

    @Override
    public void run() {
        while (true) {
            System.out.println("è¯·è¾“å…¥æœåŠ¡å™¨è¦æ¨é€çš„ä¿¡æ¯(è¾“å…¥exité€€å‡º)");
            String news = Utility.readString(100);

            if("exite".equals(news)){
                break;
            }
            // æœåŠ¡å™¨æ¨é€ä¿¡æ¯çš„æœ¬è´¨å°±æ˜¯ç¾¤å‘
            Message message = new Message();
            message.setSender("æœåŠ¡å™¨");
            message.setContent(news);
            message.setMesType(MessageType.MESSAGE_TO_ALL_MES);
            message.setSendTime(new Date().toString());
            System.out.println("æœåŠ¡å™¨æ¨é€ä¿¡æ¯ç»™æ‰€æœ‰äººè¯´ï¼š" + news);

            // éå†é›†åˆï¼Œæ‹¿åˆ° socketï¼Œå‘é€ä¿¡æ¯
            HashMap<String, ServerConnectClientThread> hm = ManageClientThreads.getHm();
            Iterator<String> iterator = hm.keySet().iterator();
            while (iterator.hasNext()){
                String onLineUserId = iterator.next().toString();
                try {
                    ObjectOutputStream oos = new ObjectOutputStream(hm.get(onLineUserId).getSocket().getOutputStream());
                    oos.writeObject(message);
                } catch (IOException e) {
                    e.printStackTrace();
                }
            }
        }
    }
}

```

## ğŸ‰ å®Œç»“ï¼šåŠŸèƒ½æµ‹è¯• ğŸ‰

![alt text](æœåŠ¡å™¨æ¨é€æ¶ˆæ¯æµ‹è¯•.png)
