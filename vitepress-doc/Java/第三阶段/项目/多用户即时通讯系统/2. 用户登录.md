---
aside: right
outline: [2, 3]
---

<h1 style="text-align: center; font-weight: bold;">ç”¨æˆ·ç™»å½•</h1>

---

##### è®¾è®¡æ€è·¯ï¼ˆ<span style = "color:red;font-weight:bold">éå¸¸é‡è¦ï¼ï¼ï¼</span>ï¼‰

![alt text](è®¾è®¡æ€è·¯.png)

## è¯´æ˜

> #### å› ä¸ºè¿˜æ²¡æœ‰å­¦ä¹ æ•°æ®åº“ï¼Œæˆ‘ä»¬äººä¸ºè§„å®š ç”¨æˆ·å id = 100, å¯†ç  123456 å°±å¯ä»¥ç™»å½•ï¼Œå…¶å®ƒç”¨æˆ·ä¸èƒ½ç™»å½•
>
> #### åé¢ä½¿ç”¨ <span style = "color:red">HashMap</span> æ¨¡æ‹Ÿæ•°æ®åº“ï¼Œå¯ä»¥å¤šä¸ªç”¨æˆ·ç™»å½•.

#### å¼€å‘æ€è·¯

part 1

- é¦–å…ˆç¼–å†™ Userã€Message å¯¹è±¡

part 2

- ç¼–å†™ç”¨æˆ·ç•Œé¢

part 3

- ç¼–å†™ç”¨æˆ·ç«¯çš„ socketï¼Œç”¨äºå’ŒæœåŠ¡ç«¯çš„é€šä¿¡ï¼šç™»å½•æ£€æµ‹åŠŸèƒ½
- ç¼–å†™ç”¨æˆ·ç«¯ä¸æœåŠ¡è¿æ¥çš„çº¿ç¨‹

part 4

- ç¼–å†™ç”¨æˆ·ç«¯çš„é›†åˆï¼Œç”¨æ¥ç®¡ç†çº¿ç¨‹

part 5

- ç¼–å†™æœåŠ¡ç«¯çš„ socketï¼ŒåŒæ—¶ç¼–å†™çº¿ç¨‹ï¼ŒæŠŠ socket æ”¾åˆ°çº¿ç¨‹ä¸­ï¼Œå®ç°å’Œç”¨æˆ·ç«¯é€šä¿¡

part 6

- ç¼–å†™æœåŠ¡ç«¯çš„é›†åˆï¼Œç”¨äºç®¡ç†çº¿ç¨‹

part 7

- æµ‹è¯•é˜¶æ®µï¼ŒåŒæ—¶å¢åŠ å¤šç”¨æˆ·ç™»å½•åŠŸèƒ½

## part 1

### 1. æ–°å»ºé¡¹ç›®

- ç¼–å†™ä¸¤ä¸ªé¡¹ç›®ï¼Œå®ç°åˆ†ç±»å¼€å‘

  - QQClientï¼šå®¢æˆ·ç«¯
  - QQServerï¼šæœåŠ¡ç«¯

- æ–°å»ºåŒ… commonï¼Œè¡¨ç¤ºå…±åŒçš„ï¼Œåœ¨è¯¥åŒ…ä¸‹åˆ›å»ºå¦‚ä¸‹å†…å®¹

### 2. è¯´æ˜

- ç”±äºæ˜¯å¤šç”¨æˆ·é€šä¿¡ï¼Œéœ€è¦è€ƒè™‘åˆ°å¯¹è±¡çš„ç‰¹å¾ï¼Œåç»­ä½¿ç”¨<span style = "color:red;font-weight:bold">å¯¹è±¡æµ</span>æ¥å¤„ç†ä¿¡æ¯ï¼Œéœ€è¦<span style = "color:red;font-weight:bold">å®ç° Serializable æ¥å£</span>
- ä¸ºäº†é˜²æ­¢åºåˆ—åŒ–å¯¹è±¡æ—¶å‡ºç°å†²çªï¼Œå¯ä»¥ç»™å¯¹è±¡<span style = "color:red;font-weight:bold">æ·»åŠ ç‰ˆæœ¬å·å±æ€§</span>

### 3. Message å¯¹è±¡

ç»™å‡ºå¦‚ä¸‹å±æ€§

- åºåˆ—åŒ–ç‰ˆæœ¬å·å±æ€§
- senderï¼šå‘é€æ–¹
- getterï¼šæ¥æ”¶æ–¹
- contentï¼šä¿¡æ¯çš„å†…å®¹
- sendTimeï¼šå‘é€æ—¶é—´
- mesTypeï¼šæ¶ˆæ¯ç±»å‹ï¼ˆå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ¶ˆæ¯ç±»å‹ï¼‰
- getterã€setter æ–¹æ³•

```java
package common;

import java.io.Serializable;

public class Message implements Serializable {
    // ä¸ºäº†é˜²æ­¢åºåˆ—åŒ–å†²çªï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸‹ç‰ˆæœ¬
    private static final long serialVersionUID = 1L;

    private String sender; // å‘é€æ–¹
    private String getter; // æ¥æ”¶æ–¹
    private String content; // ä¿¡æ¯çš„å†…å®¹
    private String sendTime; // å‘é€æ—¶é—´
    private String mesType; // æ¶ˆæ¯ç±»å‹ï¼ˆå¯ä»¥åœ¨æ¥å£ä¸­å®šä¹‰æ¶ˆæ¯ç±»å‹ï¼‰

    // ç»™å‡º setter å’Œ getter æ–¹æ³•

    public String getSender() {
        return sender;
    }

    public void setSender(String sender) {
        this.sender = sender;
    }

    public String getGetter() {
        return getter;
    }

    public void setGetter(String getter) {
        this.getter = getter;
    }

    public String getContent() {
        return content;
    }

    public void setContent(String content) {
        this.content = content;
    }

    public String getSendTime() {
        return sendTime;
    }

    public void setSendTime(String sendTime) {
        this.sendTime = sendTime;
    }

    public String getMesType() {
        return mesType;
    }

    public void setMesType(String mesType) {
        this.mesType = mesType;
    }
}
```

### 4. User å¯¹è±¡

ç»™å‡ºå¦‚ä¸‹å±æ€§

- åºåˆ—åŒ–ç‰ˆæœ¬å·å±æ€§
- userIdï¼šç”¨æˆ·å
- passwdï¼šç”¨æˆ·å¯†ç 
- getterã€setter æ–¹æ³•

```java
package common;

import java.io.Serializable;

public class User implements Serializable {
     // ä¸ºäº†é˜²æ­¢åºåˆ—åŒ–å†²çªï¼Œè¿™é‡Œå¯ä»¥è®¾ç½®ä¸€ä¸‹ç‰ˆæœ¬
    private static final long serialVersionUID = 1L;

    private String userId; // ç”¨æˆ·å
    private String passwd; // ç”¨æˆ·å¯†ç 

    public User() {

    }

    public User(String userId, String passwd) {
        this.userId = userId;
        this.passwd = passwd;
    }

    // ç»™å‡º setter å’Œ getter æ–¹æ³•

    public String getUserId() {
        return userId;
    }

    public void setUserId(String userId) {
        this.userId = userId;
    }

    public String getPasswd() {
        return passwd;
    }

    public void setPasswd(String passwd) {
        this.passwd = passwd;
    }
}
```

### 5. MessageType æ¥å£

```java
package common;

public interface MessageType {
    String MESSAGE_LOGIN_SUCCEED = "1"; // è¡¨ç¤ºç™»å½•æˆåŠŸ
    String MESSAGE_LOGIN_FAIL = "2"; // è¡¨ç¤ºç™»å½•å¤±è´¥
}

```

### 6. æ³¨æ„ç‚¹

#### å¯¹äºå®¢æˆ·ç«¯æ¥è¯´ä¹Ÿæ˜¯åŒæ ·çš„é“ç†ï¼Œå¯ä»¥æŠŠä»£ç å¤åˆ¶åˆ°æœåŠ¡ç«¯

## part 2

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part2é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:30px;font-weight:bold;"><center>é˜¶æ®µä»»åŠ¡ï¼šç¼–å†™ç”¨æˆ·ç•Œé¢</center></span>

### 2. è¡¥å…… APIï¼šUtility

```java
package utils;


/**
	å·¥å…·ç±»çš„ä½œç”¨:
	å¤„ç†å„ç§æƒ…å†µçš„ç”¨æˆ·è¾“å…¥ï¼Œå¹¶ä¸”èƒ½å¤ŸæŒ‰ç…§ç¨‹åºå‘˜çš„éœ€æ±‚ï¼Œå¾—åˆ°ç”¨æˆ·çš„æ§åˆ¶å°è¾“å…¥ã€‚
*/

import java.util.*;
/**


*/
public class Utility {
	//é™æ€å±æ€§ã€‚ã€‚ã€‚
    private static Scanner scanner = new Scanner(System.in);


    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„ä¸€ä¸ªèœå•é€‰é¡¹ï¼Œå€¼ï¼š1â€”â€”5çš„èŒƒå›´
     * @return 1â€”â€”5
     */
	public static char readMenuSelection() {
        char c;
        for (; ; ) {
            String str = readKeyBoard(1, false);//åŒ…å«ä¸€ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²
            c = str.charAt(0);//å°†å­—ç¬¦ä¸²è½¬æ¢æˆå­—ç¬¦charç±»å‹
            if (c != '1' && c != '2' &&
                c != '3' && c != '4' && c != '5') {
                System.out.print("é€‰æ‹©é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š");
            } else break;
        }
        return c;
    }

	/**
	 * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„ä¸€ä¸ªå­—ç¬¦
	 * @return ä¸€ä¸ªå­—ç¬¦
	 */
    public static char readChar() {
        String str = readKeyBoard(1, false);//å°±æ˜¯ä¸€ä¸ªå­—ç¬¦
        return str.charAt(0);
    }
    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„ä¸€ä¸ªå­—ç¬¦ï¼Œå¦‚æœç›´æ¥æŒ‰å›è½¦ï¼Œåˆ™è¿”å›æŒ‡å®šçš„é»˜è®¤å€¼ï¼›å¦åˆ™è¿”å›è¾“å…¥çš„é‚£ä¸ªå­—ç¬¦
     * @param defaultValue æŒ‡å®šçš„é»˜è®¤å€¼
     * @return é»˜è®¤å€¼æˆ–è¾“å…¥çš„å­—ç¬¦
     */

    public static char readChar(char defaultValue) {
        String str = readKeyBoard(1, true);//è¦ä¹ˆæ˜¯ç©ºå­—ç¬¦ä¸²ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªå­—ç¬¦
        return (str.length() == 0) ? defaultValue : str.charAt(0);
    }

    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„æ•´å‹ï¼Œé•¿åº¦å°äº2ä½
     * @return æ•´æ•°
     */
    public static int readInt() {
        int n;
        for (; ; ) {
            String str = readKeyBoard(2, false);//ä¸€ä¸ªæ•´æ•°ï¼Œé•¿åº¦<=2ä½
            try {
                n = Integer.parseInt(str);//å°†å­—ç¬¦ä¸²è½¬æ¢æˆæ•´æ•°
                break;
            } catch (NumberFormatException e) {
                System.out.print("æ•°å­—è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š");
            }
        }
        return n;
    }
    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„ æ•´æ•°æˆ–é»˜è®¤å€¼ï¼Œå¦‚æœç›´æ¥å›è½¦ï¼Œåˆ™è¿”å›é»˜è®¤å€¼ï¼Œå¦åˆ™è¿”å›è¾“å…¥çš„æ•´æ•°
     * @param defaultValue æŒ‡å®šçš„é»˜è®¤å€¼
     * @return æ•´æ•°æˆ–é»˜è®¤å€¼
     */
    public static int readInt(int defaultValue) {
        int n;
        for (; ; ) {
            String str = readKeyBoard(10, true);
            if (str.equals("")) {
                return defaultValue;
            }

			//å¼‚å¸¸å¤„ç†...
            try {
                n = Integer.parseInt(str);
                break;
            } catch (NumberFormatException e) {
                System.out.print("æ•°å­—è¾“å…¥é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š");
            }
        }
        return n;
    }

    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²
     * @param limit é™åˆ¶çš„é•¿åº¦
     * @return æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²
     */

    public static String readString(int limit) {
        return readKeyBoard(limit, false);
    }

    /**
     * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²æˆ–é»˜è®¤å€¼ï¼Œå¦‚æœç›´æ¥å›è½¦ï¼Œè¿”å›é»˜è®¤å€¼ï¼Œå¦åˆ™è¿”å›å­—ç¬¦ä¸²
     * @param limit é™åˆ¶çš„é•¿åº¦
     * @param defaultValue æŒ‡å®šçš„é»˜è®¤å€¼
     * @return æŒ‡å®šé•¿åº¦çš„å­—ç¬¦ä¸²
     */

    public static String readString(int limit, String defaultValue) {
        String str = readKeyBoard(limit, true);
        return str.equals("")? defaultValue : str;
    }


	/**
	 * åŠŸèƒ½ï¼šè¯»å–é”®ç›˜è¾“å…¥çš„ç¡®è®¤é€‰é¡¹ï¼ŒYæˆ–N
	 * å°†å°çš„åŠŸèƒ½ï¼Œå°è£…åˆ°ä¸€ä¸ªæ–¹æ³•ä¸­.
	 * @return Yæˆ–N
	 */
    public static char readConfirmSelection() {
        System.out.println("è¯·è¾“å…¥ä½ çš„é€‰æ‹©(Y/N)");
        char c;
        for (; ; ) {//æ— é™å¾ªç¯
        	//åœ¨è¿™é‡Œï¼Œå°†æ¥å—åˆ°å­—ç¬¦ï¼Œè½¬æˆäº†å¤§å†™å­—æ¯
        	//y => Y n=>N
            String str = readKeyBoard(1, false).toUpperCase();
            c = str.charAt(0);
            if (c == 'Y' || c == 'N') {
                break;
            } else {
                System.out.print("é€‰æ‹©é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š");
            }
        }
        return c;
    }

    /**
     * åŠŸèƒ½ï¼š è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²
     * @param limit è¯»å–çš„é•¿åº¦
     * @param blankReturn å¦‚æœä¸ºtrue ,è¡¨ç¤º å¯ä»¥è¯»ç©ºå­—ç¬¦ä¸²ã€‚
     * 					  å¦‚æœä¸ºfalseè¡¨ç¤º ä¸èƒ½è¯»ç©ºå­—ç¬¦ä¸²ã€‚
     *
	 *	å¦‚æœè¾“å…¥ä¸ºç©ºï¼Œæˆ–è€…è¾“å…¥å¤§äºlimitçš„é•¿åº¦ï¼Œå°±ä¼šæç¤ºé‡æ–°è¾“å…¥ã€‚
     * @return
     */
    private static String readKeyBoard(int limit, boolean blankReturn) {

		//å®šä¹‰äº†å­—ç¬¦ä¸²
		String line = "";

		//scanner.hasNextLine() åˆ¤æ–­æœ‰æ²¡æœ‰ä¸‹ä¸€è¡Œ
        while (scanner.hasNextLine()) {
            line = scanner.nextLine();//è¯»å–è¿™ä¸€è¡Œ

			//å¦‚æœline.length=0, å³ç”¨æˆ·æ²¡æœ‰è¾“å…¥ä»»ä½•å†…å®¹ï¼Œç›´æ¥å›è½¦
			if (line.length() == 0) {
                if (blankReturn) return line;//å¦‚æœblankReturn=true,å¯ä»¥è¿”å›ç©ºä¸²
                else continue; //å¦‚æœblankReturn=false,ä¸æ¥å—ç©ºä¸²ï¼Œå¿…é¡»è¾“å…¥å†…å®¹
            }

			//å¦‚æœç”¨æˆ·è¾“å…¥çš„å†…å®¹å¤§äºäº† limitï¼Œå°±æç¤ºé‡å†™è¾“å…¥
			//å¦‚æœç”¨æˆ·å¦‚çš„å†…å®¹ >0 <= limit ,æˆ‘å°±æ¥å—
            if (line.length() < 1 || line.length() > limit) {
                System.out.print("è¾“å…¥é•¿åº¦ï¼ˆä¸èƒ½å¤§äº" + limit + "ï¼‰é”™è¯¯ï¼Œè¯·é‡æ–°è¾“å…¥ï¼š");
                continue;
            }
            break;
        }

        return line;
    }
}

```

### 2. QQview æ–‡ä»¶

ç¼–å†™ç”¨æˆ·ç•Œé¢ï¼ˆèœå•ï¼‰

```java
package view;

import utils.Utility;

public class QQView {
    private boolean loop = true;
    private String key = "";

    // åšæµ‹è¯•
    public static void main(String[] args) {
        new QQView().mainMenu();
    }

    // æ˜¾ç¤ºä¸»èœå•
    private void mainMenu(){
        while (loop){
            System.out.println("===========æ¬¢è¿ç™»å½•ç½‘ç»œé€šä¿¡ç³»ç»Ÿ===========");
            System.out.println("\t\t 1 ç™»å½•ç³»ç»Ÿ");
            System.out.println("\t\t 9 é€€å‡ºç³»ç»Ÿ");
            System.out.print("è¯·è¾“å…¥ä½ çš„é€‰æ‹©: ");
            key = Utility.readString(1);

            switch (key) {
                case "1":
                    System.out.print("è¯·è¾“å…¥ç”¨æˆ·å·: ");
                    String userId = Utility.readString(50);
                    System.out.print("è¯·è¾“å…¥å¯†  ç : ");
                    String pwd = Utility.readString(50);
                    // éœ€è¦åœ¨æœåŠ¡ç«¯éªŒè¯æ˜¯å¦ç™»å½•æˆåŠŸï¼Œå¹¶åœ¨ç”¨æˆ·ç«¯è¿”å›
                    if (true) { // è¿˜æ²¡æœ‰å†™å®Œ....
                        System.out.println("===========æ¬¢è¿ (ç”¨æˆ· " + userId + " ç™»å½•æˆåŠŸ) ===========");
                        //è¿›å…¥åˆ°äºŒçº§èœå•
                        while (loop) {
                            System.out.println("\n=========ç½‘ç»œé€šä¿¡ç³»ç»ŸäºŒçº§èœå•(ç”¨æˆ· " + userId + " )=======");
                            System.out.println("\t\t 1 æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·åˆ—è¡¨");
                            System.out.println("\t\t 2 ç¾¤å‘æ¶ˆæ¯");
                            System.out.println("\t\t 3 ç§èŠæ¶ˆæ¯");
                            System.out.println("\t\t 4 å‘é€æ–‡ä»¶");
                            System.out.println("\t\t 9 é€€å‡ºç³»ç»Ÿ");
                            System.out.print("è¯·è¾“å…¥ä½ çš„é€‰æ‹©: ");
                            key = Utility.readString(1);
                            switch (key) {
                                case "1":
                                    System.out.println("1 æ˜¾ç¤ºåœ¨çº¿ç”¨æˆ·åˆ—è¡¨");
                                    break;
                                case "2":
                                    System.out.println("2 ç¾¤å‘æ¶ˆæ¯");
                                    break;
                                case "3":
                                    System.out.println("3 ç§èŠæ¶ˆæ¯");
                                    break;
                                case "4":
                                    System.out.println("4 å‘é€æ–‡ä»¶");
                                    break;
                                case "9":
                                    System.out.println("é€€å‡ºç³»ç»Ÿ...");
                                    loop = false;
                                    break;
                            }

                        }
                    } else { //ç™»å½•æœåŠ¡å™¨å¤±è´¥
                        System.out.println("=========ç™»å½•å¤±è´¥=========");
                    }
                    break;
                case "9":
                    System.out.println("é€€å‡ºç³»ç»Ÿ...");
                    loop = false;
                    break;
            }
        }
    }
}

```

## part 3

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part3é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:25px;font-weight:bold;">é˜¶æ®µä»»åŠ¡ï¼šç¼–å†™ç”¨æˆ·ç«¯ç™»å½•æ£€æµ‹åŠŸèƒ½ï¼Œé€šè¿‡ socket ç»™æœåŠ¡ç«¯å‘é€ä¿¡æ¯å’Œæ¥æ”¶ä¿¡æ¯ï¼ŒåŒæ—¶æŠŠè¿™ä¸ªè¿‡ç¨‹æ”¾åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­</span>

### 2. UserClientService

åœ¨å‰é¢å·²ç»ç¼–å†™å¥½äº†ç•Œé¢ï¼Œç°åœ¨éœ€è¦ç¼–å†™ä¸šåŠ¡åˆ¤æ–­ç”¨æˆ·æ˜¯å¦ç™»å½•æˆåŠŸï¼Œæ‰€ä»¥è¿™é‡Œæ–°å»ºä¸€ä¸ªç±»
æ€è·¯å¦‚ä¸‹

- é¦–å…ˆè·å–è¾“å…¥æµè¾“å‡ºæµå¯¹è±¡ï¼Œä½¿ç”¨<span style="color:red;font-weight:bold">å¯¹è±¡æµ</span>è¯»å–å’Œè¾“å‡ºä¿¡æ¯
- ç¼–å†™å‘æœåŠ¡ç«¯å‘é€ä¿¡æ¯ã€æ¥æ”¶æœåŠ¡ç«¯ä¿¡æ¯åŠŸèƒ½æ¨¡å—

```java
package service;

import common.Message;
import common.MessageType;
import common.User;

import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.InetAddress;
import java.net.Socket;

public class UserClientService {

    // å› ä¸ºå¯èƒ½éœ€è¦åœ¨å…¶ä»–æ–¹æ³•ä½¿ç”¨userä¿¡æ¯
    private User u = new User();
    // å› ä¸º socket å¯èƒ½åœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œåšæˆå±æ€§
    private Socket socket;

    // åˆ¤æ–­ç”¨æˆ·æ˜¯å¦åˆæ³•
    public boolean checkUser(String userId, String pwd) {
        u.setUserId(userId);
        u.setPasswd(pwd);

        try {
            socket = new Socket(InetAddress.getLocalHost().getHostAddress(), 9999);

            // å‘é€ u å¯¹è±¡åˆ°æœåŠ¡å™¨
            ObjectOutputStream oos = new ObjectOutputStream(socket.getOutputStream());
            oos.writeObject(u);

            // è¯»å–æœåŠ¡ç«¯è¿”å›çš„ message å¯¹è±¡
            ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
            Message ms = (Message) ois.readObject();

            // åˆ¤æ–­
            if (ms.getMesType().equals(MessageType.MESSAGE_LOGIN_SUCCEED)) { // ç™»å½•æˆåŠŸ
                // åˆ›å»ºä¸€ä¸ªå’ŒæœåŠ¡ç«¯ä¿æŒé€šä¿¡çš„çº¿ç¨‹
                ClientConnectServerThread clientConnectServerThread = new ClientConnectServerThread(socket);
                // å¯åŠ¨å®¢æˆ·ç«¯çº¿ç¨‹
                clientConnectServerThread.start();
                b = true;
            } else {

            }

        } catch (Exception e) {
            e.printStackTrace();
        }
    }

}
```

### 3. ClientConnectServerThread

åœ¨å¼€å§‹æ—¶é¡¹ç›®çš„ä»‹ç»ä¸­æåˆ°äº†å¤šç”¨æˆ·ï¼Œå¯ä»¥ä½¿ç”¨çº¿ç¨‹æ¥ç‹¬ç«‹ä¸åŒç”¨æˆ·ä¹‹é—´çš„é€šè®¯ï¼Œä¸Šé¢å·²ç»å†™å¥½äº†ç”¨æˆ·ç«¯çš„ç™»å½•åˆ¤æ–­çš„å¤§è‡´é€»è¾‘ï¼Œç°åœ¨éœ€è¦ç¼–å†™ç”¨æˆ·ç«¯å’ŒæœåŠ¡ç«¯é€šä¿¡çš„çº¿ç¨‹

```java
package service;

import common.Message;

import java.io.ObjectInputStream;
import java.net.Socket;

public class ClientConnectServerThread extends Thread{

    private Socket socket;

    // å¯ä»¥æ¥æ”¶ä¸€ä¸ª socket å¯¹è±¡
    public ClientConnectServerThread(Socket socket) {
        this.socket = socket;
    }

    @Override
    public void run() {
        // åœ¨åå°å’ŒæœåŠ¡å™¨é€šè®¯
        while (true){
            System.out.println("ç­‰å¾…è¯»å–æœåŠ¡ç«¯çš„ä¿¡æ¯...");
            try {
                ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
                // å¦‚æœæœåŠ¡ç«¯æ²¡æœ‰å‘é€ä¿¡æ¯ï¼Œçº¿ç¨‹ä¼šé˜»å¡åœ¨è¿™é‡Œ
                Message message = (Message) ois.readObject();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }

    // ä¸ºäº†æ›´æ–¹ä¾¿çš„å¾—åˆ° socket
    public Socket getSocket() {
        return socket;
    }

}
```

## part 4

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part4é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:25px;font-weight:bold;">é˜¶æ®µä»»åŠ¡ï¼šç¼–å†™é›†åˆï¼ˆHashMapï¼‰ï¼Œç®¡ç†çº¿ç¨‹</span>

### 2. ManagerClientConnectServerThread

ç¼–å†™ç”¨æˆ·ç«¯çº¿ç¨‹ç®¡ç†é›†åˆ

- keyï¼šuserId
- valueï¼šçº¿ç¨‹

```java
package service;

import java.util.HashMap;

public class ManagerClientConnectServerThread {
    // æŠŠå¤šçº¿ç¨‹æ”¾åˆ° hashmap é›†åˆä¸­ç®¡ç†ï¼Œkeyï¼šç”¨æˆ·idï¼Œvalueï¼šçº¿ç¨‹
    private static HashMap<String,ClientConnectServerThread> hm = new HashMap<>();

    // æŠŠçº¿ç¨‹åŠ å…¥é›†åˆ
    public static  void addClientConnectSercerThread(String userId,ClientConnectServerThread clientConnectServerThread){
        hm.put(userId,clientConnectServerThread);
    }

    // é€šè¿‡ userId è·å–çº¿ç¨‹
    public static ClientConnectServerThread getClientConnectServerThread(String userId){
        return hm.get(userId);
    }
}

```

### 3. UserClientService

å®Œå–„è¯¥ç±»ï¼Œçº¿ç¨‹é›†åˆå·²ç»å†™å¥½äº†ï¼ŒæŠŠè¿™ä¸ªçº¿ç¨‹æ”¾åˆ°é›†åˆä¸­

```java
// åˆ¤æ–­
if (ms.getMesType().equals(MessageType.MESSAGE_LOGIN_SUCCEED)) { // ç™»å½•æˆåŠŸ

    // åˆ›å»ºä¸€ä¸ªå’ŒæœåŠ¡ç«¯ä¿æŒé€šä¿¡çš„çº¿ç¨‹
    ClientConnectServerThread clientConnectServerThread = new ClientConnectServerThread(socket);
    // å¯åŠ¨å®¢æˆ·ç«¯çº¿ç¨‹
    clientConnectServerThread.start();
    // ä¸ºäº†æ–¹ä¾¿ç®¡ç†çº¿ç¨‹ï¼Œæ”¾åˆ°é›†åˆä¸­
    ManagerClientConnectServerThread.addClientConnectSercerThread(userId, clientConnectServerThread);
    b = true;
}
```

### 4. QQClient

ç”¨æˆ·ç«¯å·²ç»å†™å¥½äº†ç™»å½•çš„åˆ¤æ–­é€»è¾‘ï¼Œè°ƒç”¨æ–¹æ³•ç”¨æ¥åˆ¤æ–­å®¢æˆ·ç«¯æ˜¯å¦ç™»å½•æˆåŠŸ

```java
 if (userClientService.checkUser(userId,pwd)) {
    System.out.println("===========æ¬¢è¿ (ç”¨æˆ· " + userId + " ç™»å½•æˆåŠŸ) ===========");
    //è¿›å…¥åˆ°äºŒçº§èœå•
    ...
 }
```

## part 5

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part5é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:25px;font-weight:bold;">é˜¶æ®µä»»åŠ¡ï¼šå»¶ç»­å®¢æˆ·ç«¯çš„ç™»é™†éªŒè¯é€»è¾‘ï¼Œç°åœ¨ç¼–å†™-->æœåŠ¡ç«¯ï¼Œç¼–å†™æœåŠ¡ç«¯çš„ socketï¼Œå®ç°å’Œå®¢æˆ·ç«¯é€šè®¯ï¼ŒæŠŠ socket æ”¾åˆ°ä¸€ä¸ªçº¿ç¨‹ä¸­ï¼Œå¹¶ä¸”å¯åŠ¨</span>

### 2. QQServer

ç¼–å†™æœåŠ¡ç«¯çš„ socketï¼Œç”¨äºæ¥æ”¶ç”¨æˆ·ç«¯çš„ä¿¡æ¯åˆ¤æ–­æ˜¯å¦ç™»å½•æˆåŠŸï¼Œå¹¶æŠŠä¿¡æ¯è¿”å›

**æ³¨æ„ç‚¹**ï¼šæœåŠ¡ç«¯ä¸æ˜¯ä¹‹å’Œä¸€ä¸ª socket é€šä¿¡ï¼Œä¼šæœ‰å¾ˆå¤šï¼Œæ‰€ä»¥éœ€è¦**ä½¿ç”¨å¾ªç¯æ¥ä¸æ–­ç›‘å¬ç«¯å£å®ç°å’Œå¤šç”¨æˆ·é€šè®¯**

```java
package service;

import common.Message;
import common.MessageType;
import common.User;

import java.io.ObjectInputStream;
import java.io.ObjectOutputStream;
import java.net.ServerSocket;
import java.net.Socket;

public class QQServer {

    private ServerSocket ss =null;

    public  QQServer(){
        // æ³¨æ„ï¼šç«¯å£å¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶
        System.out.println("æœåŠ¡å™¨åœ¨ 9999 ç«¯å£ç›‘å¬...");
        try {
            ss = new ServerSocket(9999);
            // ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯
            while (true){
                Socket socket = ss.accept(); // å¦‚æœæ²¡æœ‰å®¢æˆ·ç«¯è¿æ¥ï¼Œå°±ä¼šé˜»å¡
                ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
                User u = (User)ois.readObject();

                // åˆ›å»º Message å¯¹è±¡ï¼Œå›å¤å®¢æˆ·ç«¯ä¿¡æ¯
                ObjectOutputStream oos = new ObjectOutputStream(socket.getOutputStream());
                Message message = new Message();

                // éªŒè¯ç™»å½•
                if(u.getUserId().equals("100")&& u.getPasswd().equals("123456")){ // ç™»å½•æˆåŠŸ
                    message.setMesType(MessageType.MESSAGE_LOGIN_SUCCEED);
                    oos.writeObject(message);
                    // åˆ›å»ºçº¿ç¨‹å’Œå®¢æˆ·ç«¯ä¿æŒé€šè®¯
                    ServerConnectClientThread serverConnectClientThread = new ServerConnectClientThread(socket, u.getUserId());
                    serverConnectClientThread.start(); // å¯åŠ¨çº¿ç¨‹
                    // æŠŠçº¿ç¨‹æ”¾åˆ°é›†åˆä¸­
                    ...
                }
            }
        } catch (Exception e) {
            e.printStackTrace();
        } finally {

        }

    }
}
```

### 3. ServerConnectClientThread

ç¼–å†™å’Œç”¨æˆ·ç«¯è¿æ¥çš„çº¿ç¨‹ï¼ŒæŠŠæœåŠ¡ç«¯çš„ socket æ”¾åˆ°çº¿ç¨‹ä¸­ï¼Œå®ç°å’Œå¤šç”¨æˆ·çš„ç‹¬ç«‹é€šä¿¡

```java
package service;

import common.Message;

import java.io.IOException;
import java.io.ObjectInputStream;
import java.net.Socket;

public class ServerConnectClientThread extends Thread{

    private Socket socket;
    private String userId; // è¿æ¥æœåŠ¡ç«¯çš„ç”¨æˆ· id

    public ServerConnectClientThread(Socket socket, String userId) {
        this.socket = socket;
        this.userId = userId;
    }

    @Override
    public void run() { // çº¿ç¨‹ï¼Œå¯ä»¥ç»™å®¢æˆ·ç«¯å‘é€ä¿¡æ¯æˆ–è€…æ¥æ”¶å®¢æˆ·ç«¯çš„ä¿¡æ¯
        while(true){
            System.out.println("æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯" + userId + "ä¿æŒé€šä¿¡ï¼Œè¯»å–æ•°æ®ä¸­...");
            try {
                ObjectInputStream ois = new ObjectInputStream(socket.getInputStream());
                Message message = (Message) ois.readObject();
            } catch (Exception e) {
                e.printStackTrace();
            }
        }
    }
}
```

## part 6

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part6é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:25px;font-weight:bold;">é˜¶æ®µä»»åŠ¡ï¼šç¼–å†™æœåŠ¡ç«¯é›†åˆï¼ˆHashMapï¼‰ï¼Œç®¡ç†çº¿ç¨‹</span>

### 2. ManageClientThreads

æ€è·¯å’Œå®¢æˆ·ç«¯ç±»ä¼¼

```java
package service;

import java.util.HashMap;

public class ManageClientThreads {

    private static HashMap<String,ServerConnectClientThread> hm = new HashMap<>();

    // æ·»åŠ çº¿ç¨‹å¯¹è±¡åˆ° hm é›†åˆä¸­ï¼Œkeyï¼šuserId ï¼Œvalueï¼šçº¿ç¨‹
    public static void addClientThread(String userId, ServerConnectClientThread serverConnectClientThread){
        hm.put(userId,serverConnectClientThread);
    }

    // æ ¹æ® userId è¿”å›çº¿ç¨‹
    public static ServerConnectClientThread getServerConnectClientThread(String userId){
        return hm.get(userId);
    }
}
```

### 3. QQServer

è¡¥å……éªŒè¯ç™»å½•çš„éƒ¨åˆ†

- ç™»å½•æˆåŠŸï¼šæŠŠçº¿ç¨‹æ”¾åˆ°é›†åˆä¸­
- è¡¥å……ç™»å½•å¤±è´¥çš„é€»è¾‘
- å…³é—­èµ„æº

```java
try {
    ss = new ServerSocket(9999);
    // ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯
    while (true){
        ...
        // éªŒè¯ç™»å½•
        if(u.getUserId().equals("100")&& u.getPasswd().equals("123456")){ // ç™»å½•æˆåŠŸ
            message.setMesType(MessageType.MESSAGE_LOGIN_SUCCEED);
            oos.writeObject(message);
            // åˆ›å»ºçº¿ç¨‹å’Œå®¢æˆ·ç«¯ä¿æŒé€šè®¯
            ServerConnectClientThread serverConnectClientThread = new ServerConnectClientThread(socket, u.getUserId());
            serverConnectClientThread.start(); // å¯åŠ¨çº¿ç¨‹
            // æŠŠçº¿ç¨‹æ”¾åˆ°é›†åˆä¸­
            ManageClientThreads.addClientThread(u.getUserId(),serverConnectClientThread);
        }else {
            // ç™»å½•å¤±è´¥
            message.setMesType(MessageType.MESSAGE_LOGIN_FAIL);
            oos.writeObject(message);
            // å…³é—­ socket
            socket.close();
        }
    }
} catch (Exception e) {
    e.printStackTrace();
} finally {
    // å¦‚æœæœåŠ¡ç«¯é€€å‡ºäº† while å¾ªç¯ï¼Œä¸å†ç›‘å¬ï¼Œéœ€è¦å…³é—­ ServerSocket
    try {
        ss.close();
    } catch (IOException e) {
        e.printStackTrace();
    }
}
```

## part 7

### 1. é¡¹ç›®ç»“æ„

![alt text](ç™»å½•part7é¡¹ç›®ç»“æ„.png)

<span style = "color:red;font-size:25px;font-weight:bold;">é˜¶æ®µä»»åŠ¡ï¼šæµ‹è¯•é˜¶æ®µï¼ŒåŒæ—¶å¢åŠ å¤šç”¨æˆ·ç™»å½•åŠŸèƒ½</span>

### 2. QQserver

å¢åŠ å¤šç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼Œä¿®æ”¹ç™»å½•æ£€æµ‹é€»è¾‘

```java
public class QQServer {

    private ServerSocket ss = null;

    // åˆ›å»ºä¸€ä¸ªé›†åˆï¼Œå­˜æ”¾å¤šä¸ªç”¨æˆ·
    private static HashMap<String,User> validUsers = new HashMap<>();

    static { // é™æ€ä»£ç å—ï¼Œç±»åŠ è½½æ—¶ä¼šåˆå§‹åŒ– validUsers
        validUsers.put("100",new User("100","123456"));
        validUsers.put("200",new User("200","123456"));
        validUsers.put("300",new User("300","123456"));
        validUsers.put("jacksonling",new User("jacksonling","123456"));
    }

    // éªŒè¯ç”¨æˆ·æ˜¯å¦æœ‰æ•ˆ
    private boolean checkUser(String userId,String passwd){
        User user = validUsers.get(userId);
        // ç”¨æˆ·ä¸å­˜åœ¨
        if(user == null){
            return false;
        }
        // ç”¨æˆ·å­˜åœ¨ï¼Œå¯†ç é”™è¯¯
        if(!user.getPasswd().equals(passwd)){
            return false;
        }
        return true;
    }

    public  QQServer(){
        // æ³¨æ„ï¼šç«¯å£å¯ä»¥å†™åœ¨é…ç½®æ–‡ä»¶
        System.out.println("æœåŠ¡å™¨åœ¨ 9999 ç«¯å£ç›‘å¬...");
        try {
            ss = new ServerSocket(9999);
            // ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯
            while (true){
                ...
                // éªŒè¯ç™»å½•
                if(checkUser(u.getUserId(),u.getPasswd())){ // ç™»å½•æˆåŠŸ
                    ...
                }
            }
        } catch (Exception e) {
            ...
        } finally {
            ...
        }
    }
}
```

### 3. QQFrame

åˆ›å»ºä¸»å‡½æ•°å…¥å£ï¼Œç”¨æ¥å¯åŠ¨æœåŠ¡ç«¯

```java
package qqframe;

import service.QQServer;

public class QQFrame {
    public static void main(String[] args) {
        new QQServer();
    }
}
```

## ğŸ‰ å®Œç»“ï¼šåŠŸèƒ½æµ‹è¯• ğŸ‰

### ä¸€ã€å¯åŠ¨å¤šä¸ªç”¨æˆ·ç«¯çº¿ç¨‹é…ç½®

![alt text](å¤šä¸ªç”¨æˆ·ç«¯çº¿ç¨‹é…ç½®.png)

### äºŒã€ç”¨æˆ·ç«¯æµ‹è¯•å›¾ä¾‹

![alt text](ç™»å½•ç”¨æˆ·ç«¯æµ‹è¯•.png)

### ä¸‰ã€æœåŠ¡ç«¯æµ‹è¯•å›¾ä¾‹

![alt text](ç™»å½•æœåŠ¡ç«¯æµ‹è¯•.png)

### å››ã€é¡¹ç›®ç»“æ„å›é¡¾

#### ï¼ˆ1ï¼‰å®¢æˆ·ç«¯

![alt text](ç™»å½•å®Œç»“ï¼šå®¢æˆ·ç«¯é¡¹ç›®ç»“æ„.png)

#### ï¼ˆ2ï¼‰æœåŠ¡ç«¯

![alt text](ç™»å½•å®Œç»“ï¼šæœåŠ¡ç«¯é¡¹ç›®ç»“æ„.png)
